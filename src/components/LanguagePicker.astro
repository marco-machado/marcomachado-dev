---
import { getLangFromUrl, getOtherLang, useTranslations } from "@/i18n/utils";
import { getRelativeLocaleUrl } from "astro:i18n";

const lang = getLangFromUrl(Astro.url);
const otherLang = getOtherLang(lang);
const t = useTranslations(lang);

const pathSegments = Astro.url.pathname.split("/").filter(Boolean);
const pathWithoutLang =
  lang === "en" ? pathSegments.join("/") : pathSegments.slice(1).join("/");
const switchUrl = getRelativeLocaleUrl(otherLang, pathWithoutLang);
---

<a
  href={switchUrl}
  class="flex items-center gap-1 p-2 rounded-md text-[var(--color-ink-muted)] hover:text-[var(--color-ink)] dark:text-[var(--color-ink-muted-dark)] dark:hover:text-[var(--color-ink-dark)] no-underline transition-colors"
  aria-label={t("lang.switch")}
>
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="18"
    height="18"
    viewBox="0 0 24 24"
    fill="none"
    stroke="currentColor"
    stroke-width="1.5"
    stroke-linecap="round"
    stroke-linejoin="round"
  >
    <circle cx="12" cy="12" r="10"></circle>
    <path d="M2 12h20"></path>
    <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
  </svg>
  <span class="text-xs font-medium uppercase">{otherLang}</span>
</a>
