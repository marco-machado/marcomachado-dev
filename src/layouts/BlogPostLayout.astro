---
import BaseLayout from "./BaseLayout.astro";
import GiscusComments from "@/components/GiscusComments.astro";
import NewsletterSignup from "@/components/NewsletterSignup.astro";
import {
  useTranslations,
  formatDate,
  getLocalizedPath,
  type Lang,
} from "@/i18n/utils";

interface Props {
  title: string;
  description: string;
  pubDate: Date;
  updatedDate?: Date;
  tags: string[];
  lang: "en" | "pt";
}

const { title, description, pubDate, updatedDate, tags, lang } = Astro.props;
const t = useTranslations(lang as Lang);
---

<BaseLayout title={title} description={description} lang={lang}>
  <article>
    <a
      href={getLocalizedPath(lang as Lang, "blog")}
      class="text-sm text-muted no-underline hover:text-[var(--color-accent)] dark:hover:text-[var(--color-accent-dark)] transition-colors inline-flex items-center gap-1 mb-8"
    >
      <span aria-hidden="true">&larr;</span>
      {t("post.back")}
    </a>

    <header class="mb-10">
      <h1 class="mb-3">{title}</h1>
      <div
        class="flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-muted font-[var(--font-mono)]"
      >
        <time datetime={pubDate.toISOString()}>
          {t("post.published")} {formatDate(pubDate, lang as Lang)}
        </time>
        {
          updatedDate && (
            <time datetime={updatedDate.toISOString()}>
              {t("post.updated")} {formatDate(updatedDate, lang as Lang)}
            </time>
          )
        }
      </div>
      {
        tags.length > 0 && (
          <div class="mt-4 flex flex-wrap gap-2">
            {tags.map((tag) => (
              <span class="text-xs font-[var(--font-mono)] text-muted px-2 py-0.5 bg-[var(--color-paper-raised)] dark:bg-[var(--color-paper-raised-dark)] rounded">
                {tag}
              </span>
            ))}
          </div>
        )
      }
    </header>

    <div class="article-content">
      <slot />
    </div>

    <NewsletterSignup />
    <GiscusComments />
  </article>
</BaseLayout>
